<CFSET completed_filter = (IsDefined("URL.completed_filter") AND IsNumeric(URL.completed_filter) ? URL.completed_filter : 0)>
                
<ul class="mode_toggle">
<a href="javascript:nop()" onClick="showCompleted(false)"><li <CFIF completed_filter IS 0>class="selected"</CFIF>>incomplete</li></a>
<a href="javascript:nop()" onClick="showCompleted(true)"><li <CFIF completed_filter IS 1>class="selected"</CFIF>>complete</li></a>
</ul>
                    
<CFQUERY NAME="Reconciliation" DATASOURCE="#DSN#">
SELECT *,Returns.stamp AS return_date FROM Returns
INNER JOIN Receivables ON Receivables.returnid=Returns.returnid
INNER JOIN Transactions ON Transactions.receivableid=Receivables.receivableid
INNER JOIN Products ON Products.productid=Returns.productid
INNER JOIN Customers ON Customers.customerid=Products.customerid
<!---WHERE Products.account = 1--->
<CFIF completed_filter IS 1>
    AND reconciled IS NOT NULL
<CFELSE>
    AND reconciled IS NULL
</CFIF>
ORDER BY Returns.stamp DESC
</CFQUERY>

<table class="infotable alternating receivables editable">
    <thead>
        <tr>
            <th class="text">ID</th>
            <th class="text">Return Date</th>
            <th class="text">Item #</th>
            <th class="text">Client Name</th>
            <th class="text">Description</th>
            <th class="numeric">Packing (pcs/cs)</th>
            <th class="numeric">Cases Damaged</th>
            <th class="numeric">Cases Undamaged</th>
            <CFIF completed_filter IS 0>
                <th class="glyph"></th>
            <cfelse>
                <th class="text">Reconciled</th>
            </cfif>
        </tr>
    </thead>
    <tbody>
    <CFOUTPUT QUERY="Reconciliation">

        <tr class="shipment" id="receivable_#receivableid#">
            <td class="id returnid="#returnid#">#returnid#</td>
            <td class="text" returnid="#returnid#">#DateFormat(return_date,"MM/DD/YYYY")#</td>
            <td class="text" returnid="#returnid#">#itemnum#</td>
            <td class="text" returnid="#returnid#">#coname#</td>
            <td class="text" returnid="#returnid#">#pname#</td>
            <td class="numeric" returnid="#returnid#">#packing#</td>
            <td class="numeric" returnid="#returnid#">#cases_damaged#</td>
            <td class="numeric" returnid="#returnid#">#cases_undamaged#</td>
            <CFIF completed_filter IS 0>
                <td class="glyph" returnid="#returnid#">
                    <a href="javascript:nop()" onClick="completeReconciliation(#returnid#)" class="ui-icon ui-icon-circle-arrow-e" title="Complete"></a>
                </td>
            <cfelse>
                <td class="text" returnid="#returnid#">
                    #DateFormat(reconciled,"MM/DD/YYYY")#
                </td>
            </cfif>
        </tr>
    </CFOUTPUT>
    </tbody>
</table>

